<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="FinaceDavid.Views.TransactionsPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:viewmodels="clr-namespace:FinaceDavid.ViewModels"
    xmlns:domain="clr-namespace:FinaceDavid.Domain.Entities"
    BackgroundColor="{DynamicResource SurfaceColor}"
    x:DataType="viewmodels:TransactionsViewModel">
    <ContentPage.ToolbarItems>
        <ToolbarItem Text="Adicionar" Command="{Binding AddTransactionCommand}" />
    </ContentPage.ToolbarItems>
    <Grid RowDefinitions="Auto,Auto,*" Padding="16" RowSpacing="16">
        <StackLayout Orientation="Horizontal" Spacing="8">
            <Button Text="Todas" Command="{Binding SetTabCommand}" CommandParameter="Todas" Style="{StaticResource FilterChipStyle}" />
            <Button Text="Entradas" Command="{Binding SetTabCommand}" CommandParameter="Entrada" Style="{StaticResource FilterChipStyle}" />
            <Button Text="Saídas" Command="{Binding SetTabCommand}" CommandParameter="Saida" Style="{StaticResource FilterChipStyle}" />
        </StackLayout>
        <Grid Grid.Row="1" ColumnDefinitions="*,Auto" RowDefinitions="Auto,Auto" ColumnSpacing="8" RowSpacing="8">
            <Entry
                Grid.Row="0"
                Placeholder="Buscar descrição"
                Text="{Binding SearchText, Mode=TwoWay}"
                BackgroundColor="{DynamicResource CardBackgroundColor}"
                TextColor="{DynamicResource PrimaryTextColor}"
                PlaceholderColor="{DynamicResource SecondaryTextColor}"
                MinimumHeightRequest="48" />
            <Entry
                Grid.Row="1"
                Placeholder="Categoria"
                Text="{Binding Categoria, Mode=TwoWay}"
                BackgroundColor="{DynamicResource CardBackgroundColor}"
                TextColor="{DynamicResource PrimaryTextColor}"
                PlaceholderColor="{DynamicResource SecondaryTextColor}"
                MinimumHeightRequest="48" />
            <Switch Grid.Column="1" Grid.RowSpan="2" IsToggled="{Binding IncludePending}" VerticalOptions="Center" />
        </Grid>
        <CollectionView Grid.Row="2" ItemsSource="{Binding Transactions}" SelectionMode="None">
            <CollectionView.ItemTemplate>
                <DataTemplate x:DataType="domain:Transaction">
                    <SwipeView>
                        <SwipeView.RightItems>
                            <SwipeItems>
                                <SwipeItem Text="Editar" BackgroundColor="{DynamicResource AccentColor}" Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:TransactionsViewModel}}, Path=EditTransactionCommand}" CommandParameter="{Binding .}" />
                                <SwipeItem Text="Excluir" BackgroundColor="{DynamicResource DangerColor}" Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:TransactionsViewModel}}, Path=DeleteTransactionCommand}" CommandParameter="{Binding .}" />
                            </SwipeItems>
                        </SwipeView.RightItems>
                        <Border StrokeShape="RoundRectangle 18" BackgroundColor="{DynamicResource CardBackgroundColor}" Padding="16" Margin="0,0,0,12">
                            <Grid ColumnDefinitions="*,Auto" RowDefinitions="Auto,Auto">
                                <Label Text="{Binding Descricao}" FontAttributes="Bold" TextColor="{DynamicResource PrimaryTextColor}" />
                                <Label Grid.Row="1" Text="{Binding Categoria}" TextColor="{DynamicResource SecondaryTextColor}" />
                                <Label Grid.Column="1" Text="{Binding Valor, StringFormat='R$ {0:N2}'}" TextColor="{DynamicResource PrimaryTextColor}" />
                                <Label Grid.Column="1" Grid.Row="1" Text="{Binding Data, StringFormat='{0:dd/MM/yyyy HH:mm}'}" TextColor="{DynamicResource SecondaryTextColor}" />
                            </Grid>
                        </Border>
                    </SwipeView>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>
    </Grid>
</ContentPage>
